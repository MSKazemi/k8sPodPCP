# ===========================================
# JOB 2: Build labels from Kepler metrics
# ===========================================
---
apiVersion: batch/v1
kind: Job
metadata:
  name: build-labels
  namespace: energy
spec:
  backoffLimit: 1
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: labels
        # Replace sha-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX with the commit-specific tag
        # emitted by CI for this build (ghcr.io/...:sha-<commit-sha>).
        image: ghcr.io/mskazemi/k8spodpcp:sha-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
        imagePullPolicy: IfNotPresent
        args:
          - python3
          - kepler_labels.py
          - --prom
          - http://prometheus-operated.prometheus.svc:9090
          - --mode
          - job
          - --start
          - "2025-10-25T00:00:00Z"
          - --end
          - "2025-10-26T00:00:00Z"
          - --ns
          - kubeintellect
          - --out
          - /data/labels.parquet
        volumeMounts:
        - name: data
          mountPath: /data
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: podpower-data
