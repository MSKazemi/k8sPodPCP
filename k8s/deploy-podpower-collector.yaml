apiVersion: apps/v1
kind: Deployment
metadata: {name: podpower-collector, namespace: energy}
spec:
  replicas: 1
  selector: {matchLabels: {app: podpower-collector}}
  template:
    metadata: {labels: {app: podpower-collector}}
    spec:
      serviceAccountName: podpower-read
      containers:
      - name: collector
        # Replace sha-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX with the commit-specific tag
        # produced by CI (ghcr image sha). Avoid using mutable tags like :latest.
        image: ghcr.io/mskazemi/k8spodpcp:sha-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
        args:
          - python
          - k8s_collect.py
          - watch
          - --kinds
          - Deployment Job CronJob
          - --namespaces
          - energy
          - --emit-initial
          - --post
          - http://podpower-predict.energy.svc/predict
          - --suppress-tls-warnings
